# License Plate Recognition Branch Configuration
# Used with branch_type: "plate_recognition"

params:
  point_confidence_threshold: 0.5
  ocr_confidence_threshold: 0.9
  log_interval: 1.0
  visualize_keypoints: true

  # OCR Configuration
  ocr_engine_path: "data/license_plate/ocr/bz2_640/ppocr_dummy.engine"
  ocr_dict_path: "data/license_plate/ocr/bz2_640/licence_plate_dict.txt"
  ocr_queue_size: 100
  ocr_input_shape: [2, 3, 48, 640]

  # OSD Display Colors (RGBA normalized 0.0-1.0)
  color_valid: [0.0, 1.0, 0.0, 1.0]      # Green - valid plate
  color_invalid: [1.0, 0.5, 0.0, 1.0]    # Orange - invalid plate

  # Keypoint visualization colors (RGBA)
  keypoint_colors:
    - [0.0, 1.0, 0.0, 1.0]    # Green - top-left
    - [1.0, 1.0, 0.0, 1.0]    # Yellow - top-right
    - [1.0, 0.0, 0.0, 1.0]    # Red - bottom-right
    - [1.0, 0.0, 1.0, 1.0]    # Magenta - bottom-left
  keypoint_radius: 8

  # Display settings
  border_width: 3
  text_font_size: 14

sink:
  enable: true
  type: filesink
  properties:
    location: "${OUTPUT_DIR:data/license_plate/output/plate_output.avi}"
    sync: false
    qos: false

muxer:
  batch-size: 8
  width: 1920
  height: 1080
  nvbuf-memory-type: 0
  batched-push-timeout: 40000
  live-source: 1

elements:
  - type: queue
    properties:
      max-size-buffers: 2
  - type: nvvideoconvert
    name: pre_tiler_conv
    properties: { nvbuf-memory-type: 3 }  # CUDA_UNIFIED for frame access
  - type: capsfilter
    name: rgba_caps
    caps: "video/x-raw(memory:NVMM), format=RGBA"
  - type: nvinfer
    name: pgie_plate
    config_file: "data/license_plate/detect/infer.txt"


  - type: nvtracker
    name: tracker_plate
    config_file: "data/license_plate/NvDCF/config_tracker.txt"
    probes:
      src: tracker_plate_probe

  - type: nvmultistreamtiler
    properties:
      rows: 2
      columns: 2
      width: 1920
      height: 1080

  - type: nvdsosd
    properties:
      process-mode: 0
      display-text: 1
    probes:
      src: plate_fps_probe